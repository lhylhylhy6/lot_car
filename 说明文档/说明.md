### 1.应用场景

​		该车主要功能为根据用户下发的路径信息进行自动驾驶，到达目标地点后采集目标地点的温湿度信息，并上传至Onenet平台供用户查看，该车可以应用于环境监测，环保工程等对数据采集有需要的地方。在改装别的传感器后,也可实现对大气环境等应用场景的监测。

### 2.硬件架构图

![image-20220802105923086](https://cdn.jsdelivr.net/gh/lhylhylhy6/Picgo/202208021059143.png)

### 3.软件架构图

![image-20220802112300422](https://cdn.jsdelivr.net/gh/lhylhylhy6/Picgo/202208021123467.png)

### 4.硬件情况

1. OpenMV模块识别路径信息,并通过UART传输数据到RA6M4主控.
2. RA6M4主控通过计算,控制PWM的参数,控制TB6612电机驱动模块,进而控制电机.
3. DTH11模块通过单总线协议把测量到的温湿度数据传输到RA6M4主控中.
4. ESP8266模块通过UART与RA6M4主控进行通信,实现连接WIFI,连接Onenet平台
5. LORA模块通过UART与主控通信,实现无线控制台.
6. 红外传感器通过控制IO电平高低,通知主控进行停车.

### 5.软件说明

#### 文件

![image-20220802151520172](https://cdn.jsdelivr.net/gh/lhylhylhy6/Picgo/202208021515220.png)

controller.c 与 controller.h中定义了 车的一些状态和车的动作,包括左转,右转等.

hal_entry.c 相当于平常我们所说的main.c 在这个文件中,实现了外部中断,还有一些系统的初始化

measure.c 与 measure.h 中实现了温度的读取和上传.

my_pwm.c 与 my_pwm.h 中实现了PWM相关的操作,如设置PWM的占空比等

pid.c 与 pid.h 中实现了PID算法.

uart0_t.c 与 uart0_t.h 中实现了串口0的接收功能和解析数据的功能.

#### 线程

​	本次项目创建了4个线程,功能分别如下:

1. uart0_read线程:用于处理OpenMV传输来的数据,对数据进行解析,供PID计算使用.也可以从数据中解析出是否到达十字路口,然后进行下一步动作.
2. mqtt线程:用于mqtt心跳包的发送以及上传数据.
3. measure线程:用于测量温湿度以及上传数据到云端
4. pid_thread线程:用于计算PID ,并且控制PWM,改变小车的运行状态.

#### 软件包

​    本次项目使用了5个软件包,分别如下:

1. at_device
2. cJSON
3. dhtxx
4. onenet
5. pahomqtt

### 6.演示视频

[演示视频](https://www.bilibili.com/video/BV1MN4y1j7BV?spm_id_from=333.999.0.0&vd_source=1eb279d767c0ee6733681a8a87572555)